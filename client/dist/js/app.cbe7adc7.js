(function(e){function t(t){for(var n,i,c=t[0],s=t[1],l=t[2],u=0,d=[];u<c.length;u++)i=c[u],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);m&&m(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,c=1;c<r.length;c++){var s=r[c];0!==o[s]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={app:0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var m=s;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1:function(e,t){},"10a3":function(e,t,r){"use strict";var n=r("bf04"),o=r.n(n);o.a},1527:function(e,t,r){"use strict";var n=r("46af"),o=r.n(n);o.a},1898:function(e,t,r){"use strict";var n=r("521e"),o=r.n(n);o.a},2:function(e,t){},3:function(e,t){},"46af":function(e,t,r){},"521e":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("4bea"),o=r.n(n),a=r("2b0e"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.setup?e._e():r("Setup",{on:{complete:e.showPreview}}),e.setup?r("h1",[e._v("RoomId: "+e._s(e.roomId))]):e._e(),r("div",{staticClass:"main-preview"},[e.setup?r("Preview",{attrs:{stream:e.previewStream,name:e.name,controls:""}}):e._e()],1),r("Members",{on:{changePreview:e.changePreview}})],1)},c=[],s=(r("b0c0"),r("5530")),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ValidationObserver",{attrs:{slim:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("button",{attrs:{type:"button"},on:{click:function(t){return e.setMode("create")}}},[e._v("Create")]),r("button",{attrs:{type:"button"},on:{click:function(t){return e.setMode("join")}}},[e._v("Join")]),e.mode?r("form",{on:{submit:function(r){return r.preventDefault(),t.handleSubmit(e.handleForm)}}},[r("Input",{attrs:{placeholder:"Enter RoomID",name:"room ID",rules:"required|min:6",id:"roomId"},model:{value:e.roomId,callback:function(t){e.roomId=t},expression:"roomId"}}),r("Input",{attrs:{placeholder:"Enter Name",name:"name",rules:"required|min:3",id:"name"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),r("button",{attrs:{type:"submit",disabled:t.invalid}},[e._v("Enter")])],1):e._e()]}}])})],1)},m=[],u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"form-input"},[r("ValidationProvider",{attrs:{name:e.name,vid:e.id,rules:e.rules},scopedSlots:e._u([{key:"default",fn:function(t){return[r("input",{attrs:{type:e.type,placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)},change:function(t){return e.$emit("change",t)}}}),r("span",[e._v(e._s(t.errors[0]))])]}}])})],1)},d=[],f={name:"Input",props:{type:{type:String,default:"text"},value:String,placeholder:String,name:{type:String,required:!0},id:{type:String,required:!0},rules:String}},p=f,v=r("2877"),h=Object(v["a"])(p,u,d,!1,null,null,null),b=h.exports,g=r("94ea"),w={name:"Setup",components:{Input:b},data:function(){return{roomId:null,name:null}},computed:Object(s["a"])({},Object(g["d"])({mode:"mode"})),methods:Object(s["a"])(Object(s["a"])({},Object(g["b"])({saveStream:"saveLocalStream",setMode:"setMode"})),{},{handleForm:function(){var e=this;console.log(this.name,this.roomId),window.navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"environment"}}).then((function(t){console.log("got stream",t),e.saveStream(t),e.$emit("complete",{name:e.name,roomId:e.roomId})})).catch((function(t){console.log("camera access failed"),console.log(t),e.$emit("complete",{name:e.name,roomId:e.roomId})})),this.$socket.client.emit("REGISTER",{name:this.name,roomId:this.roomId})}})},S=w,_=Object(v["a"])(S,l,m,!1,null,null,null),y=_.exports,O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("p",[e._v(e._s(e.name))]),r("video",{ref:"video",attrs:{controls:e.controls,muted:""},domProps:{muted:!0}})])},j=[],k=(r("99af"),r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),{name:"Preview",props:{stream:{required:!0},name:{type:String,required:!0},controls:{type:Boolean,default:!1}},data:function(){return{recordedChunks:[],recorder:null,seq:0,timer:null}},computed:Object(s["a"])({},Object(g["d"])({mode:"mode"})),watch:{stream:function(e){console.log("new stream",e),this.$refs.video.srcObject=e,this.$refs.video.play(),this.recorder&&"recording"==this.recorder.state||this.startRecording()}},mounted:function(){this.$refs.video.srcObject=this.stream,this.$refs.video.play(),!this.controls&&this.stream&&this.startRecording()},beforeDestroy:function(){this.stopRecording(!0),clearTimeout(this.timer)},methods:{startRecording:function(){var e=this;"create"==this.mode&&(this.recordedChunks=[],this.seq+=1,this.recorder||(this.recorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp9"}),this.recorder.ondataavailable=this.handleDataAvailable),this.recorder.start(3e3),this.timer=setTimeout((function(){e.stopRecording()}),3e4))},stopRecording:function(e){var t=this;this.recorder.stop(),console.log("stopped recording"),setTimeout((function(){t.saveRecording(),e||t.startRecording()}),1e3)},saveRecording:function(){var e=new Blob(this.recordedChunks,{type:"video/webm"});console.log("blob created from chunks");var t=URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=t;var n=new Date;r.download="".concat(this.name,"_").concat(this.seq,"_").concat(n.getDate(),"-").concat(n.getMonth()+1,"-").concat(n.getFullYear(),".webm"),r.click(),window.URL.revokeObjectURL(t),console.log("downloading")},handleDataAvailable:function(e){console.log(this.name,this.recorder.state,e.data.size),e.data.size>1&&this.recordedChunks.push(e.data)}}}),P=k,I=(r("1898"),Object(v["a"])(P,O,j,!1,null,"5e62201e",null)),M=I.exports,R=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"members"},e._l(e.members,(function(t){return r("div",{key:t.id,staticClass:"member",on:{click:function(r){return e.$emit("changePreview",t)}}},[e._v(" "+e._s(t.id)+" "),e.$socket.client.id==t.id?r("Preview",{attrs:{stream:e.localStream,name:t.name}}):r("Preview",{attrs:{stream:t.stream,name:t.name}})],1)})),0)},$=[],x={name:"Members",components:{Preview:M},computed:Object(s["a"])({},Object(g["c"])({members:"allMembers",localStream:"getLocalStream"}))},E=x,q=(r("1527"),Object(v["a"])(E,R,$,!1,null,"4534f4c6",null)),C=q.exports,L={name:"App",components:{Setup:y,Preview:M,Members:C},data:function(){return{setup:!1,name:null,roomId:null,previewStream:null}},watch:{localStream:function(e){this.previewStream=e}},computed:Object(s["a"])({},Object(g["d"])(["localStream"])),methods:{showPreview:function(e){var t=e.name,r=e.roomId;this.setup=!0,this.name=t,this.roomId=r},changePreview:function(e){e.stream?this.previewStream=e.stream:this.previewStream=this.localStream}}},D=L,T=(r("10a3"),Object(v["a"])(D,i,c,!1,null,"3737c59b",null)),U=T.exports,B=r("9ac9"),V=r("fb74"),z=r("79dc");Object(V["c"])("required",Object(s["a"])(Object(s["a"])({},z["b"]),{},{message:"{_field_} is required"})),Object(V["c"])("min",Object(s["a"])(Object(s["a"])({},z["a"]),{},{params:["length"],message:"{_field_} must be {length} characters"})),a["a"].component("ValidationProvider",V["b"]),a["a"].component("ValidationObserver",V["a"]);r("4de4"),r("4160"),r("07ac"),r("159b");var A=r("6e32"),F=r.n(A);a["a"].use(g["a"]);var J=new g["a"].Store({state:{localStream:null,members:{},mode:null},getters:{allMembers:function(e){return Object.values(e.members)},getPeerById:function(e){return function(t){return e.members[t].peer}},getLocalStream:function(e){return e.localStream}},mutations:{setLocalStream:function(e,t){e.localStream=t},setRemoteStream:function(e,t){var r=t.id,n=t.stream;a["a"].set(e.members[r],"stream",n)},saveMembers:function(e,t){t.forEach((function(t){e.members[t.id]||a["a"].set(e.members,t.id,t)}))},addNewPeer:function(e,t){var r=t.id,n=t.peer;a["a"].set(e.members[r],"peer",n)},setMode:function(e,t){e.mode=t},removeMember:function(e,t){a["a"].delete(e.members,t)}},actions:{saveLocalStream:function(e,t){e.commit("setLocalStream",t)},socket_register:function(e,t){var r=this,n=t.id,o=t.members;console.log("register",o),e.commit("saveMembers",o);var a=e.getters.allMembers.filter((function(e){return e.id!=r._vm.$socket.client.id}));console.log("others",a),a.forEach((function(t){if(!t.peer){var o=new F.a({initiator:n==r._vm.$socket.client.id});o.on("signal",(function(e){console.log("peer signal ===>  ".concat(e.type," for ").concat(t.id)),r._vm.$socket.client.emit("signal",{id:t.id,signal:e})})),o.on("connect",(function(){console.log("peer connected"),e.state.localStream&&o.addStream(e.state.localStream)})),o.on("close",(function(){console.log("peer closed")})),o.on("error",(function(e){console.log("peer error",e)})),o.on("stream",(function(r){console.log("stream received",r),e.commit("setRemoteStream",{id:t.id,stream:r}),e.state.localStream&&o.addStream(e.state.localStream)})),e.commit("addNewPeer",{id:t.id,peer:o})}}))},socket_leave:function(e,t){var r=t.id;console.log("".concat(r," left room")),e.commit("removeMember",r)},socket_signal:function(e,t){var r=t.id,n=t.signal;console.log("socket signal <=== from ".concat(r," of type ").concat(n.type)),e.getters.getPeerById(r).signal(n)},setMode:function(e,t){e.commit("setMode",t)}}}),N=J;a["a"].use(B["a"],o()("https://recorder.cyberoze.com/api",{path:"/api/socket.io/"}),{store:N,actionPrefix:"socket_",mutationPrefix:"socket_"}),new a["a"]({store:N,render:function(e){return e(U)}}).$mount("#app")},bf04:function(e,t,r){}});
//# sourceMappingURL=app.cbe7adc7.js.map